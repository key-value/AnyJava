
`AOF`重写和`RDB`快照执行的过程中，`redis`都会`fork`一个子进程来执行操作，子进程执行过程中是不是阻塞主线程的。

-   `fork`子进程的过程中，`redis`主线程会拷贝一份内存页表(记录了虚拟内存和物理内存的映射关系)给子进程，这个过程是阻塞的，`redis`主线程内存越大，阻塞时间越长；
    
-   子进程和`redis`主线程共用一块儿物理内存，如果新的请求到来，必须使用`copy on write`的方式，拷贝要修改的数据页到新的内存空间进行修改。如下图：

![[Pasted image 20210815213908.png]]